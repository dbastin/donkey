<?xml version="1.0" encoding="UTF-8"?>

<project name="base-sweeper" default="sweep">
    <property name="ant.dir" value="build/ant"/>
    <import file="base-init.xml"/>

    <target name="sweep">
        <mkdir dir="${sweeper.dir}"/>
        <groovy classpath="${build.dir}/groovy">
            import sweeper.FixSweeper

            def srcFiles = ant.fileScanner {
                fileset(refid: 'sweeper.fix.files')
            }
            def maxDays = properties.get('sweeper.fix.maxdays').toInteger()
            def warnDays = properties.get('sweeper.fix.warndays').toInteger()
            def dir = properties.get('sweeper.dir')
            def report = new File(dir, 'fixes.xml')
            def projectName = properties.get('project.name')

            def fixSweeper = new FixSweeper(maxDays, warnDays)
            def ok = fixSweeper.sweep(projectName, srcFiles, report)
            if (!ok) ant.fail("Expired FIXES found in project files!")
        </groovy>
    </target>
</project>
