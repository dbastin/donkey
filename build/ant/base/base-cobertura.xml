<?xml version="1.0" encoding="UTF-8"?>
<project name="base-cobertura" default="ignore">
    <import file="base-init.xml"/>

    <macrodef name="macro_instrument_cobertura">
        <attribute name="test.type"/>
        <attribute name="fileset.ref"/>
        <sequential>
            <mkdir dir="${coverage.src.dir}/@{test.type}"/>
            <cobertura-instrument todir="${coverage.src.dir}/@{test.type}"
                                  datafile="${coverage.db.dir}/@{test.type}_coverage.ser">
                <fileset refid="@{fileset.ref}"/>
            </cobertura-instrument>
        </sequential>
    </macrodef>

    <macrodef name="macro_report_cobertura">
        <attribute name="code.type"/>
        <attribute name="test.type"/>
        <sequential>
            <mkdir dir="${coverage.reports.dir}/@{code.type}/@{test.type}"/>
            <cobertura-report destdir="${coverage.reports.dir}/@{code.type}/@{test.type}"
                              datafile="${coverage.db.dir}/@{test.type}_coverage.ser">
                <fileset dir="${@{code.type}.src.dir}" includes="**/*.java"/>
            </cobertura-report>
        </sequential>
    </macrodef>

    <macrodef name="macro_check_cobertura">
        <attribute name="code.type"/>
        <attribute name="test.type"/>
        <attribute name="min.coverage" default="${min.coverage}"/>
        <sequential>
            <cobertura-check totalbranchrate="@{min.coverage}" totallinerate="@{min.coverage}"
                             failureproperty="coverage.@{code.type}.failed" haltonfailure="true"
                             datafile="${coverage.db.dir}/@{test.type}_coverage.ser"/>
        </sequential>
    </macrodef>
</project>